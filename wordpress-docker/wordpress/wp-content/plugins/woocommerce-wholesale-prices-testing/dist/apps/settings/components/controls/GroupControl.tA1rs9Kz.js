import{d as M,t as P,s as W,r as v,S as X,o as m,c as k,U as Y,V as Z,e as D,w as h,b as j,W as H,X as Q,u as p,Y as ee,Z as te,a as O,f as ne,h as oe,i as ae,n as le,$ as ie}from"../../index.CKpLJebS.js";import{u as de}from"../../../../common/settings-store.D2w0DAU9.js";import{_ as ue}from"../../../../common/DataTableControl.vue_vue_type_script_setup_true_lang.Mme5Lohe.js";import{B as se}from"../../../../common/index.B1uKm7M6.js";/* empty css                                                                                      */import{_ as re}from"../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../common/GroupEditFields.vue_vue_type_script_setup_true_lang.K2yq6O2P.js";import"../../../../common/index.Cz6fo6gq.js";import"../../../../common/FormItemContext.BXddKDyF.js";import"../../../../common/createContext.DrcFD0PM.js";import"../../../../common/statusUtils.8rbnFV31.js";import"../../../../common/motion.B4vIiQau.js";import"../../../../common/SearchOutlined.BkQFM3AT.js";import"../../../../common/compact-item.DXb4BOpW.js";import"../../../../common/index.C59gMgCz.js";import"../../../../common/isPlainObject.BUa-QQa0.js";import"../../../../common/_getPrototype.BWxd4W6H.js";import"../../../../common/index.rtQl11BW.js";import"../../../../common/index.J3HrkfG-.js";import"../../../../common/KeyCode.B_gOgbN6.js";import"../../../../common/index.lCUlX3KO.js";import"../../../../common/useState.oMw7RQ-7.js";import"../../../../common/index.DqOwy4pv.js";import"../../../../common/DownOutlined.nVxd90xO.js";import"../../../../common/isMobile.BbN7I0i_.js";import"../../../../common/warning.CrM1WiW4.js";import"../../../../common/index.DAbSRysp.js";import"../../../../common/pickAttrs.BAPkhqQ0.js";import"../../../../common/slide.Ckj138X7.js";import"../../../../common/useMergedState.CK_PQlcs.js";import"../../../../common/index.DsHOaSDE.js";import"../../../../common/index.D-oY6N4s.js";import"../../../../common/ActionButton.s5OQ-7gf.js";import"../../../../common/EditOutlined.Bcr-U6WF.js";import"../../../../common/DeleteOutlined.gaD_zSBP.js";import"../../../../common/index.BSwogAMo.js";import"../../../../common/index.BIywNHnw.js";import"../../../../common/index.BsIqu5Q6.js";import"../../../../common/Checkbox.B8ih9oYN.js";import"../../../../common/index.DMKRWprG.js";import"../../../../common/debounce.BD5H0L-V.js";import"../../../../common/cloneDeep.DDO5nQxH.js";import"../../../../common/_assignValue.DvFf5YoT.js";const fe=["id"],pe={class:"data-table-buttons"},ce={class:"data-table"},ve=M({__name:"GroupControl",props:{params:{type:Object,required:!0},conditionalValues:{type:Object,required:!1,default:()=>({})}},emits:["input","fieldData","selectedCondition","conditionalData","selectedDependent","fieldUpdatedData","fieldUpdatedPopupData"],setup(S,{emit:x}){var C,V;const B=S,{params:F}=P(B),I=de(),{selectedConditionKey:K,selectedConditionValue:U,groupData:r}=W(I),A=x,s=F.value,N=s.classes,c=s.id,d=v(s.fields),f=X({fields:d.value}),u=v(s.table.data),w=s.group_action,q=v((V=(C=s.table)==null?void 0:C.inline_edit)!=null?V:!0),y=v(!1),l=v([]),g=v([]);if(typeof r.value<"u"&&Object.keys(r.value).length>0&&typeof r.value[c]<"u"&&(u.value=r.value[c]),f.fields)for(const[a,o]of Object.entries(f.fields)){const t=o;l.value[t.id]=t.default}const E=a=>{Object.entries(a).forEach(([o,t])=>{l.value[o]=t})};typeof d.value<"u"&&d.value!==null&&(f.fields=d.value.filter(a=>typeof a.hide<"u"&&a.hide!==null?!a.hide:!0));const G=a=>{let o="",t="";for(const[n,e]of Object.entries(a)){let i=e;o=n,t=i}f.fields=d.value.filter(n=>{if(typeof n.condition<"u"&&n.condition!==null){const e=n.condition.find(i=>i.key===o);return e.value==="yes"&&t==="yes"?!0:e.value==="no"&&t==="no"}else return!0}),g.value[o]=t},R=a=>{Object.assign(u.value.filter(o=>a.key===o.key)[0],a),r.value[c]=u.value},$=a=>{u.value=u.value.filter(o=>o.key!==a),r.value[c]=u.value},L=a=>{let o="",t="";for(const[n,e]of Object.entries(a)){let i=e;o=n,t=i}f.fields=d.value.filter(n=>{const e=d.value.find(i=>i.id===n.id);if(e)if(typeof e.condition<"u"&&e.condition!==null){const i=e.condition.find(_=>_.key===o);return typeof i<"u"&&i.key===o&&(!Array.isArray(i.value)&&i.value===t||Array.isArray(i.value)&&i.value.includes(t))?(typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0):!1}else return typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0;else return!1})},T=a=>{f.fields=d.value.filter(o=>{const t=d.value.find(n=>n.id===o.id);return t?typeof t.hide<"u"&&t.hide!==null&&t.hide?!1:(typeof l.value[t.id]<"u"&&l.value[t.id]!==null&&(o.default=l.value[t.id]),typeof t.dependent_option<"u"&&t.dependent_option!==null&&(o.default=t.dependent_default),!0):!1})},z=async()=>{y.value=!0;const a=[{key:"action",value:w}],o={};let t=0;if(u.value.length>0){let n=u.value.map(i=>i.key);t=Math.max(...n)+1}o.key=t;for(const[n,e]of Object.entries(l.value)){let i=e;typeof e=="object"&&e!==null&&(i=JSON.stringify(e)),a.push({key:n,value:i});let _=e;const b=d.value.find(J=>J.id===n);typeof b<"u"&&typeof b.prefix<"u"&&(_=b.prefix+e),o[n]=_}l.value=[];try{await ie(a)==="success"&&(u.value.push(o),r.value[c]=u.value,K.value="",U.value="",q.value||A("fieldUpdatedData",o)),y.value=!1}catch(n){console.error(n)}finally{y.value=!1}};return(a,o)=>(m(),k("div",{id:p(c),class:le(p(N))},[(m(!0),k(Y,null,Z(f.fields,(t,n)=>(m(),k("div",{key:n},[(m(),D(te,null,{fallback:h(()=>[j(H)]),default:h(()=>[(m(),D(Q(p(ee)(t.type)),{params:t,"conditional-values":g.value,onFieldData:E,onConditionalData:G,onSelectedCondition:L,onSelectedDependent:T},null,40,["params","conditional-values"]))]),_:2},1024))]))),128)),O("div",pe,[p(s).button_label!==""?(m(),D(p(se),{key:0,type:"primary",class:"save-group-btn",loading:y.value,onClick:z},{default:h(()=>[ne(oe(p(s).button_label),1)]),_:1},8,["loading"])):ae("",!0)]),O("div",ce,[j(ue,{params:p(s).table,data:u.value,"edit-fields":d.value,onFieldUpdatedData:R,onFieldDeletedData:$},null,8,["params","data","edit-fields"])])],10,fe))}}),at=re(ve,[["__scopeId","data-v-ac0e52be"]]);export{at as default};
